const{OPS:t}=globalThis.pdfjsLib||await import("pdfjs-lib"),e=Object.create(null);for(const n in t)e[t[n]]=n;const n=function(){let t,e=!1;const n="data-font-name";function s(){const t=document.querySelectorAll(`span[${n}]`);for(const e of t)e.className="debuggerHideText"}function a(t,e){const s=document.querySelectorAll(`span[${n}=${t}]`);for(const t of s)t.className=e?"debuggerShowText":"debuggerHideText"}function o(t){if(!t.target.dataset.fontName||"SPAN"!==t.target.tagName.toUpperCase())return;const e=t.target.dataset.fontName,n=document.getElementsByTagName("input");for(const t of n)t.dataset.fontName===e&&(t.checked=!t.checked,a(e,t.checked),t.scrollIntoView())}return{id:"FontInspector",name:"Font Inspector",panel:null,manager:null,init(){const e=this.panel,n=document.createElement("button");n.addEventListener("click",s),n.textContent="Refresh",e.append(n),t=document.createElement("div"),e.append(t)},cleanup(){t.textContent=""},enabled:!1,get active(){return e},set active(t){e=t,e?(document.body.addEventListener("click",o,!0),s()):(document.body.removeEventListener("click",o,!0),function(){const t=document.querySelectorAll(`span[${n}]`);for(const e of t)e.className=""}())},fontAdded(e,n){function o(t,e){const n=document.createElement("table");for(const s of e){const e=document.createElement("tr"),a=document.createElement("td");a.textContent=s,e.append(a);const o=document.createElement("td");o.textContent=t[s].toString(),e.append(o),n.append(e)}return n}const i=e.css?o(e,["baseFontName"]):o(e,["name","type"]),c=e.loadedName,r=document.createElement("div"),d=document.createElement("span");let l;d.textContent=c,e.css||(l=document.createElement("a"),n?(n=/url\(['"]?([^)"']+)/.exec(n),l.href=n[1]):e.data&&(l.href=URL.createObjectURL(new Blob([e.data],{type:e.mimetype}))),l.textContent="Download");const p=document.createElement("a");p.href="",p.textContent="Log",p.addEventListener("click",(function(t){t.preventDefault()}));const h=document.createElement("input");h.setAttribute("type","checkbox"),h.dataset.fontName=c,h.addEventListener("click",(function(){a(c,h.checked)})),l?r.append(h,d," ",l," ",p,i):r.append(h,d," ",p,i),t.append(r),setTimeout((()=>{this.active&&s()}),2e3)}}}(),s=function(){let t=[],e=null,n=null,s=null,o=Object.create(null);return{id:"Stepper",name:"Stepper",panel:null,manager:null,init(){const t=this;n=document.createElement("div"),s=document.createElement("select"),s.addEventListener("change",(function(e){t.selectStepper(this.value)})),n.append(s),e=document.createElement("div"),this.panel.append(n,e),sessionStorage.getItem("pdfjsBreakPoints")&&(o=JSON.parse(sessionStorage.getItem("pdfjsBreakPoints")))},cleanup(){s.textContent="",e.textContent="",t=[]},enabled:!1,active:!1,create(n){const i=document.createElement("div");i.id="stepper"+n,i.hidden=!0,i.className="stepper",e.append(i);const c=document.createElement("option");c.textContent="Page "+(n+1),c.value=n,s.append(c);const r=o[n]||[],d=new a(i,n,r);return t.push(d),1===t.length&&this.selectStepper(n,!1),d},selectStepper(e,n){e|=0,n&&this.manager.selectPanel(this);for(const n of t)n.panel.hidden=n.pageIndex!==e;for(const t of s.options)t.selected=(0|t.value)===e},saveBreakPoints(t,e){o[t]=e,sessionStorage.setItem("pdfjsBreakPoints",JSON.stringify(o))}}}();class a{#t(t,e){const n=document.createElement(t);return e&&(n.textContent=e),n}#e(t){if("string"==typeof t){const e=75;return t.length<=e?t:t.substring(0,e)+"..."}if("object"!=typeof t||null===t)return t;if("length"in t){const e=10,n=[];let s,a;for(s=0,a=Math.min(e,t.length);s<a;s++)n.push(this.#e(t[s]));return s<t.length&&n.push("..."),n}const e={};for(const n in t)e[n]=this.#e(t[n]);return e}constructor(t,e,n){this.panel=t,this.breakPoint=0,this.nextBreakPoint=null,this.pageIndex=e,this.breakPoints=n,this.currentIdx=-1,this.operatorListIdx=0,this.indentLevel=0}init(t){const e=this.panel,n=this.#t("div","c=continue, s=step"),s=this.#t("table");n.append(s),s.cellSpacing=0;const a=this.#t("tr");s.append(a),a.append(this.#t("th","Break"),this.#t("th","Idx"),this.#t("th","fn"),this.#t("th","args")),e.append(n),this.table=s,this.updateOperatorList(t)}updateOperatorList(t){const n=this;function a(){const t=+this.dataset.idx;this.checked?n.breakPoints.push(t):n.breakPoints.splice(n.breakPoints.indexOf(t),1),s.saveBreakPoints(n.pageIndex,n.breakPoints)}if(this.operatorListIdx>15e3)return;const o=document.createDocumentFragment(),i=Math.min(15e3,t.fnArray.length);for(let n=this.operatorListIdx;n<i;n++){const s=this.#t("tr");s.className="line",s.dataset.idx=n,o.append(s);const i=this.breakPoints.includes(n),c=t.argsArray[n]||[],r=this.#t("td"),d=this.#t("input");d.type="checkbox",d.className="points",d.checked=i,d.dataset.idx=n,d.onclick=a,r.append(d),s.append(r,this.#t("td",n.toString()));const l=e[t.fnArray[n]];let p=c;if("showText"===l){const t=c[0],e=this.#t("tr"),n=this.#t("tr"),s=this.#t("tr");for(const a of t)if("object"==typeof a&&null!==a)e.append(this.#t("td",a.originalCharCode)),n.append(this.#t("td",a.fontChar)),s.append(this.#t("td",a.unicode));else{const t=this.#t("td",a);t.classList.add("advance"),e.append(t),n.append(this.#t("td")),s.append(this.#t("td"))}p=this.#t("td");const a=this.#t("table");a.classList.add("showText"),p.append(a),a.append(e,n,s)}else if("constructPath"===l){const[t,[n],s]=c;p=this.#t("td"),p.append(JSON.stringify(this.#e(n))),p.append(this.#t("br")),p.append(`minMax: ${JSON.stringify(this.#e(s))}`),p.append(this.#t("br")),p.append(`â†’ ${e[t]}`)}else"restore"===l&&this.indentLevel>0&&this.indentLevel--;s.append(this.#t("td"," ".repeat(2*this.indentLevel)+l)),"save"===l&&this.indentLevel++,p instanceof HTMLElement?s.append(p):s.append(this.#t("td",JSON.stringify(this.#e(p))))}if(i<t.fnArray.length){const t=this.#t("td","...");t.colspan=4,o.append(t)}this.operatorListIdx=t.fnArray.length,this.table.append(o)}getNextBreakPoint(){this.breakPoints.sort(((t,e)=>t-e));for(const t of this.breakPoints)if(t>this.currentIdx)return t;return null}breakIt(t,e){s.selectStepper(this.pageIndex,!0),this.currentIdx=t;const n=t=>{switch(t.keyCode){case 83:document.removeEventListener("keydown",n),this.nextBreakPoint=this.currentIdx+1,this.goTo(-1),e();break;case 67:document.removeEventListener("keydown",n),this.nextBreakPoint=this.getNextBreakPoint(),this.goTo(-1),e()}};document.addEventListener("keydown",n),this.goTo(t)}goTo(t){const e=this.panel.getElementsByClassName("line");for(const n of e)(0|n.dataset.idx)===t?(n.style.backgroundColor="rgb(251,250,207)",n.scrollIntoView()):n.style.backgroundColor=null}}const o=function(){let t=[];function e(t){t.textContent=""}return{id:"Stats",name:"Stats",panel:null,manager:null,init(){},enabled:!1,active:!1,add(n,s){if(!s)return;const a=function(e){for(const[n,s]of t.entries())if(s.pageNumber===e)return n;return!1}(n);!1!==a&&(t[a].div.remove(),t.splice(a,1));const o=document.createElement("div");o.className="stats";const i=document.createElement("div");i.className="title",i.textContent="Page: "+n;const c=document.createElement("div");c.textContent=s.toString(),o.append(i,c),t.push({pageNumber:n,div:o}),t.sort(((t,e)=>t.pageNumber-e.pageNumber)),e(this.panel);for(const e of t)this.panel.append(e.div)},cleanup(){t=[],e(this.panel)}}}();class i{static#n=[];static#s=null;static tools=[n,s,o];static enable(t){const e=1===t.length&&"all"===t[0],n=this.tools;for(const s of n)(e||t.includes(s.id))&&(s.enabled=!0);e||n.sort((function(e,s){let a=t.indexOf(e.id);a=a<0?n.length:a;let o=t.indexOf(s.id);return o=o<0?n.length:o,a-o}))}static init(t,e){this.loadCSS(),this.enable(e);const n=document.createElement("div");n.id="PDFBug";const s=document.createElement("div");s.setAttribute("class","controls"),n.append(s);const a=document.createElement("div");a.setAttribute("class","panels"),n.append(a),t.append(n),t.style.right="var(--panel-width)";for(const t of this.tools){const e=document.createElement("div"),n=document.createElement("button");n.textContent=t.name,n.addEventListener("click",(e=>{e.preventDefault(),this.selectPanel(t)})),s.append(n),a.append(e),t.panel=e,t.manager=this,t.enabled?t.init():e.textContent=`${t.name} is disabled. To enable add "${t.id}" to the pdfBug parameter and refresh (separate multiple by commas).`,this.#n.push(n)}this.selectPanel(0)}static loadCSS(){const{url:t}=import.meta,e=document.createElement("link");e.rel="stylesheet",e.href=t.replace(/\.mjs$/,".css"),document.head.append(e)}static cleanup(){for(const t of this.tools)t.enabled&&t.cleanup()}static selectPanel(t){if("number"!=typeof t&&(t=this.tools.indexOf(t)),t!==this.#s){this.#s=t;for(const[e,n]of this.tools.entries()){const s=e===t;this.#n[e].classList.toggle("active",s),n.active=s,n.panel.hidden=!s}}}}globalThis.FontInspector=n,globalThis.StepperManager=s,globalThis.Stats=o;export{i as PDFBug};