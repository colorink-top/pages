import*as idbKey from"../../../../libs/idb-keyval.js";const imageStore=idbKey.createStore("image-store","image"),DEFAULTSTAMPURLKEY="custom-image-default-url",prefix="jopp://",createId=()=>prefix+Date.now();export const uploadImageFn=e=>{const t=document.createElement("input");t.setAttribute("type","file"),t.style.display="none",document.body.append(t),t.onchange=async()=>{const a=t.files[0],i=a.type;if(!/^image\//i.test(i))return void alert("Only image files can be uploaded.");const r=createId();(await idbKey.keys(imageStore)).length>20&&await idbKey.clear(imageStore),await idbKey.set(r,{file:a},imageStore),e(r)},t.click()};export const getImageURLFn=async(e="")=>{if(!e)return"";if(!e.startsWith(prefix))return e;const t=await idbKey.get(e,imageStore);if(t){return window.URL.createObjectURL(t.file)}return""};const STORAGEKEY="image-watermark-storage-key";export const defaultWatermarkOptions={id:"",size:100,opacity:.3,angle:45,x:0,y:0};export const saveOptionsFn=e=>{localStorage.setItem(STORAGEKEY,JSON.stringify(e))};export const getOptionsFn=()=>{const e=localStorage.getItem(STORAGEKEY)||"";try{return JSON.parse(e)}catch(e){return null}};