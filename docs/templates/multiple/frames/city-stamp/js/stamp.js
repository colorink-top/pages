import*as idbKey from"../../../../libs/idb-keyval.js";const stampStore=idbKey.createStore("stamp-store","stamp"),DEFAULTSTAMPURLKEY="custom-stamp-default-url",prefix="jopp://",createId=()=>prefix+Date.now();export const uploadStampFn=t=>{const e=document.createElement("input");e.setAttribute("type","file"),e.style.display="none",document.body.append(e),e.onchange=async()=>{const a=e.files[0],r=a.type;if(!/^image\//i.test(r))return void alert("Only image files can be uploaded.");const o=createId();(await idbKey.keys(stampStore)).length>20&&await idbKey.clear(stampStore),await idbKey.set(o,{file:a},stampStore),t(o)},e.click()};export const setDefaultStampIdFn=(t="")=>{localStorage.setItem(DEFAULTSTAMPURLKEY,t.trim())};export const getDefaultStampIdFn=()=>localStorage.getItem(DEFAULTSTAMPURLKEY)||"";export const getStampURLFn=async(t="")=>{if(!(t=t||getDefaultStampIdFn()))return"";if(!t.startsWith(prefix))return t;const e=await idbKey.get(t,stampStore);if(e){return window.URL.createObjectURL(e.file)}return""};