import{demoData}from"../../demo-data.js";import{getStampURLFn}from"./stamp.js";function getRandom(e,t){const o=Math.random(),n=t-e;return Math.round(n*o)+e}window.joppInit=async(e=demoData)=>{const{pdfInfo:t,documentInfo:o,templateInfo:n={}}=e,{pages:r,width:a,height:s,margin:p}=t,c=r.filter((e=>"toc"===e.type)),i=r.filter((e=>"content"===e.type)),m=(c.length,i.length),d=document.documentElement;d.style.setProperty("--marginTop",p.top+"px"),d.style.setProperty("--marginRight",p.right+"px"),d.style.setProperty("--marginBottom",p.bottom+"px"),d.style.setProperty("--marginLeft",p.left+"px"),d.style.setProperty("--width",a+"px"),d.style.setProperty("--height",s+"px"),document.querySelectorAll(".pages-container").forEach((e=>e.remove()));const l=document.querySelector(".template");l.style.display="none";const y=document.createElement("div");y.classList.add("pages-container");const g=new Date;let u=0;const h=await getStampURLFn(n.options?.stampURL);r.forEach(((e,t)=>{const n=l.cloneNode(!0);switch(n.style.removeProperty("display"),n.className="page-container",e.type){case"toc":n.innerHTML="",n.classList.add("toc-page-container"),y.append(n);break;case"content":{u++,n.classList.add("content-page-container");n.querySelector(".header .section").innerText=e?.section1||"";const t=n.querySelector(".footer .hostname a");t.innerText=o.hostname,t.href=o.url;n.querySelector(".footer .page-num").innerText=`${u}/${m}`;n.querySelector(".footer .date").innerText=g.toString(),y.append(n);const r=n.querySelector(".stamp-container"),a=n.querySelector(".stamp");u==m?r.remove():(h?a.setAttribute("src",h):a.setAttribute("src",`./imgs/stamp_${getRandom(1,7)}.png`),r.style.setProperty("--stampX",getRandom(1,100)+"%"),r.style.setProperty("--stampY",getRandom(-40,-20)+"px"),r.style.setProperty("--stampDeg",getRandom(0,360)+"deg"));break}default:n.classList.add("other-page-container"),n.innerHTML="",y.append(n)}})),document.body.append(y)};const url=new URL(document.location.href),joppPreview=url.searchParams.get("joppPreview");joppPreview&&import("./preview/index.js");